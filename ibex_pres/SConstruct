import glob
import os


PlantUMLBuilder = Builder(
    action='java -jar -Djava.awt.headless=true plantuml.jar -tpng $SOURCE -o generated/')
PrettyBuilder = Builder(
    action='html5-print $SOURCE > tmp_print.html && cp tmp_print.html $SOURCE && touch $TARGET')
TidyBuilder = Builder(
    action='tidy -config .tidy-config -m $SOURCE')
env = Environment(BUILDERS={
    'PlantUMLBuilder': PlantUMLBuilder,
    'TidyBuilder': TidyBuilder,
    'PrettyBuilder': PrettyBuilder
})


import_seq_pre = [
    'actor user'
]
import_seq_lines = [
    ('user', 'runtime', 'import ibex.sklearn.linear_model'),
    ('runtime', 'ibex', 'import ibex'),
    ('runtime', 'ibex.sklearn', 'import ibex.sklearn'),
    ('ibex.sklearn', 'ibex.sklearn', 'register sys.metapath'),
    ('runtime', 'loader', 'import ibex.sklearn.linear_model'),
    ('loader', 'sklearn.linear_model', 'dir'),
    ('sklearn.linear_model', 'loader', 'members'),
    ('loader', 'loader', 'inspect'),
    ('loader', 'loader', 'wrap'),
]


wrapper_wrapped_pre = [
    'actor user',
    'participant Wrapped',
    'participant wrapped',
]
wrapper_wrapped_lines = [
    ('user', 'Wrapped', 'predict(X)'),
    ('Wrapped', 'Wrapped', 'validate; strip'),
    ('Wrapped', 'Wrapped', 'predict(Xt)'),
    ('wrapped', 'Wrapped', 'yt'),
    ('Wrapped', 'Wrapped', 'add metadata'),
    ('Wrapped', 'user', 'y'),
]


for f_name in glob.glob('*.plantuml'):
    src, target = f_name, os.path.join('generated', os.path.splitext(f_name)[0] + '.png')
    env.PlantUMLBuilder(target, src)
#env.TidyBuilder('index.html.tidy', 'index.html')
